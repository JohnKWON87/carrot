<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ê´€ë¦¬ - ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background-color: #2c3e50;
            padding: 1rem 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e74c3c;
            text-decoration: none;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .back-btn, .logout-btn {
            background: #3498db;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .logout-btn {
            background: #e74c3c;
        }

        .back-btn:hover, .logout-btn:hover {
            transform: translateY(-2px);
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .page-header h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .filters {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-select, .search-input {
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 150px;
        }

        .search-btn, .reset-btn {
            background: #3498db;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1.7rem;
        }

        .reset-btn {
            background: #95a5a6;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .items-table th,
        .items-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .items-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .item-title {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 600;
        }

        .price {
            color: #e74c3c;
            font-weight: bold;
        }

        .status-visible {
            background: #27ae60;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        .status-blinded {
            background: #f39c12;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        .status-deleted {
            background: #e74c3c;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 0.3rem;
            transition: all 0.3s ease;
        }

        .btn-blind {
            background: #f39c12;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-restore {
            background: #27ae60;
            color: white;
        }

        .btn-view {
            background: #3498db;
            color: white;
        }

        .btn-blind:hover { background: #e67e22; }
        .btn-delete:hover { background: #c0392b; }
        .btn-restore:hover { background: #229954; }
        .btn-view:hover { background: #2980b9; }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #7f8c8d;
            font-weight: 500;
        }
    </style>
</head>
<body>
<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="navbar">
    <div class="navbar-content">
        <a href="/admin" class="logo">ê´€ë¦¬ì - ìƒí’ˆ ê´€ë¦¬</a>
        <div class="navbar-right">
            <span th:text="'ì•ˆë…•í•˜ì„¸ìš”, ' + ${user.name} + ' ê´€ë¦¬ìë‹˜'">ì•ˆë…•í•˜ì„¸ìš”, ê´€ë¦¬ìë‹˜</span>
            <a href="/admin" class="back-btn">ëŒ€ì‹œë³´ë“œ</a>
            <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</nav>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <h1>ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</h1>
        <p>ë“±ë¡ëœ ìƒí’ˆë“¤ì„ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- í†µê³„ ì •ë³´ -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-number" th:text="${totalItems} ?: '0'">0</div>
            <div class="stat-label">ì „ì²´ ìƒí’ˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" th:text="${visibleItems} ?: '0'">0</div>
            <div class="stat-label">ì •ìƒ ìƒí’ˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" th:text="${blindedItems} ?: '0'">0</div>
            <div class="stat-label">ë¸”ë¼ì¸ë“œ ìƒí’ˆ</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" th:text="${deletedItems} ?: '0'">0</div>
            <div class="stat-label">ì‚­ì œ ìƒí’ˆ</div>
        </div>
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
    <div th:if="${error}" class="error-message" th:text="${error}"></div>

    <!-- í•„í„°ë§ -->
    <div class="filters">
        <div class="filter-row">
            <div class="filter-group">
                <label>ìƒíƒœ í•„í„°</label>
                <select class="filter-select" id="statusFilter">
                    <option value="">ì „ì²´ ìƒíƒœ</option>
                    <option value="VISIBLE">ì •ìƒ</option>
                    <option value="BLINDED">ë¸”ë¼ì¸ë“œ</option>
                    <option value="DELETED">ì‚­ì œë¨</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ì¹´í…Œê³ ë¦¬</label>
                <select class="filter-select" id="categoryFilter">
                    <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                    <option value="ì „ìì œí’ˆ">ì „ìì œí’ˆ</option>
                    <option value="ì˜ë¥˜">ì˜ë¥˜</option>
                    <option value="ë„ì„œ">ë„ì„œ</option>
                    <option value="ê°€êµ¬">ê°€êµ¬</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ê²€ìƒ‰</label>
                <input type="text" class="search-input" placeholder="ìƒí’ˆëª…, ì„¤ëª…ìœ¼ë¡œ ê²€ìƒ‰..." id="searchInput">
            </div>

            <button class="search-btn" onclick="applyFilters()">í•„í„° ì ìš©</button>
            <button class="reset-btn" onclick="resetFilters()">ì´ˆê¸°í™”</button>
        </div>
    </div>

    <!-- ì»¨í…ì¸  ì„¹ì…˜ -->
    <div class="content-section">
        <!-- ìƒí’ˆ í…Œì´ë¸” -->
        <div th:if="${items != null and !items.isEmpty()}">
            <table class="items-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>ì´ë¯¸ì§€</th>
                    <th>ìƒí’ˆëª…</th>
                    <th>ê°€ê²©</th>
                    <th>ì¹´í…Œê³ ë¦¬</th>
                    <th>íŒë§¤ì</th>
                    <th>ìƒíƒœ</th>
                    <th>ì¡°íšŒìˆ˜</th>
                    <th>ë“±ë¡ì¼</th>
                    <th>ê´€ë¦¬</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${items}">
                    <td th:text="${item.id}">1</td>
                    <td>
                        <img th:src="${item.imageUrl} ?: '/images/no-image.png'"
                             class="item-image" alt="ìƒí’ˆ ì´ë¯¸ì§€">
                    </td>
                    <td>
                        <div class="item-title" th:text="${item.title}" th:title="${item.title}">
                            ìƒí’ˆ ì œëª©
                        </div>
                    </td>
                    <td class="price" th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + 'ì›'">
                        10,000ì›
                    </td>
                    <td th:text="${item.category}">ì „ìì œí’ˆ</td>
                    <td th:text="${item.seller.name}">íŒë§¤ì</td>
                    <td>
                                <span th:class="'status-' + ${#strings.toLowerCase(item.moderationStatus.name())}"
                                      th:text="${item.moderationStatus.name() == 'VISIBLE'} ? 'ì •ìƒ' :
                                                (${item.moderationStatus.name() == 'BLINDED'} ? 'ë¸”ë¼ì¸ë“œ' : 'ì‚­ì œë¨')">
                                    ì •ìƒ
                                </span>
                    </td>
                    <td th:text="${item.viewCount}">0</td>
                    <td th:text="${#temporals.format(item.createdAt, 'yyyy-MM-dd')}">2024-01-01</td>
                    <td>
                        <!-- ì •ìƒ ìƒí’ˆì¸ ê²½ìš° -->
                        <div th:if="${item.moderationStatus.name() == 'VISIBLE'}">
                            <button class="action-btn btn-view" th:onclick="'viewItem(' + ${item.id} + ')'">
                                ë³´ê¸°
                            </button>
                            <button class="action-btn btn-blind" th:onclick="'blindItem(' + ${item.id} + ')'">
                                ë¸”ë¼ì¸ë“œ
                            </button>
                            <button class="action-btn btn-delete" th:onclick="'deleteItem(' + ${item.id} + ')'">
                                ì‚­ì œ
                            </button>
                        </div>

                        <!-- ë¸”ë¼ì¸ë“œ/ì‚­ì œëœ ìƒí’ˆì¸ ê²½ìš° -->
                        <div th:if="${item.moderationStatus.name() != 'VISIBLE'}">
                            <button class="action-btn btn-view" th:onclick="'viewItem(' + ${item.id} + ')'">
                                ë³´ê¸°
                            </button>
                            <button class="action-btn btn-restore" th:onclick="'restoreItem(' + ${item.id} + ')'">
                                ë³µì›
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- ë°ì´í„°ê°€ ì—†ì„ ë•Œ -->
        <div th:if="${items == null or items.isEmpty()}" class="no-data">
            <p>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    </div>
</div>

<script>
    function applyFilters() {
        const status = document.getElementById('statusFilter').value;
        const category = document.getElementById('categoryFilter').value;
        const search = document.getElementById('searchInput').value;

        let url = '/admin/products?';
        const params = new URLSearchParams();

        if (status) params.append('status', status);
        if (category) params.append('category', category);
        if (search) params.append('search', search);

        window.location.href = url + params.toString();
    }

    function resetFilters() {
        window.location.href = '/admin/products';
    }

    function viewItem(itemId) {
        window.open('/item/' + itemId, '_blank');
    }

    function blindItem(itemId) {
        const reason = prompt('ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!reason) return;

        moderateItem(itemId, 'blind', reason);
    }

    function deleteItem(itemId) {
        const reason = prompt('ì‚­ì œ ì²˜ë¦¬ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        if (!reason) return;

        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        moderateItem(itemId, 'delete', reason);
    }

    function restoreItem(itemId) {
        if (!confirm('ìƒí’ˆì„ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        moderateItem(itemId, 'restore', 'ë³µì›');
    }

    function moderateItem(itemId, action, reason) {
        fetch('/admin/item/' + itemId + '/moderate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'action=' + action + '&reason=' + encodeURIComponent(reason)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('ì˜¤ë¥˜: ' + data.error);
            } else {
                alert('ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }

    // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            applyFilters();
        }
    });
</script>
</body>
</html>