<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ì„¤ì • - ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .navbar {
            background-color: #2c3e50;
            padding: 1rem 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e74c3c;
            text-decoration: none;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .back-btn, .logout-btn, .refresh-btn {
            background: #3498db;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .logout-btn {
            background: #e74c3c;
        }

        .refresh-btn {
            background: #27ae60;
        }

        .back-btn:hover, .logout-btn:hover, .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }

        .page-header h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .last-updated {
            position: absolute;
            top: 1rem;
            right: 2rem;
            font-size: 0.875rem;
            color: #7f8c8d;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.user { border-left: 5px solid #3498db; }
        .stat-card.item { border-left: 5px solid #e74c3c; }
        .stat-card.activity { border-left: 5px solid #f39c12; }
        .stat-card.database { border-left: 5px solid #27ae60; }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .stat-detail {
            font-size: 0.85rem;
            color: #95a5a6;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e1e8ed;
        }

        .category-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .category-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .category-name {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .category-count {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3498db;
        }

        .recent-activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-info {
            flex: 1;
        }

        .activity-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 0.25rem;
        }

        .activity-detail {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #95a5a6;
        }

        .db-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .db-info-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .db-info-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .db-info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-spinner {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .add-menu-btn {
    background: #3498db;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
}

.add-menu-btn:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.menu-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.menu-table th,
.menu-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e1e8ed;
}

.menu-table th {
    background-color: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
}

.status-active {
    background: #27ae60;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
}

.status-inactive {
    background: #95a5a6;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.75rem;
}

.action-btn {
    padding: 0.4rem 0.8rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
    margin-right: 0.3rem;
    transition: all 0.3s ease;
}

.btn-edit {
    background: #3498db;
    color: white;
}

.btn-toggle {
    background: #f39c12;
    color: white;
}

.btn-delete {
    background: #e74c3c;
    color: white;
}

.btn-edit:hover { background: #2980b9; }
.btn-toggle:hover { background: #e67e22; }
.btn-delete:hover { background: #c0392b; }

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: white;
    padding: 2rem;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover {
    color: #000;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2c3e50;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e1e8ed;
    border-radius: 8px;
    font-size: 1rem;
}

.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
}

.btn-cancel, .btn-save {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
}

.btn-cancel {
    background: #95a5a6;
    color: white;
}

.btn-save {
    background: #3498db;
    color: white;
}

.btn-cancel:hover { background: #7f8c8d; }
.btn-save:hover { background: #2980b9; }
    </style>
</head>
<body>
<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
</div>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="navbar">
    <div class="navbar-content">
        <a href="/admin" class="logo">ê´€ë¦¬ì - ì‹œìŠ¤í…œ ì„¤ì •</a>
        <div class="navbar-right">
            <span th:text="'ì•ˆë…•í•˜ì„¸ìš”, ' + ${user.name} + ' ê´€ë¦¬ìë‹˜'">ì•ˆë…•í•˜ì„¸ìš”, ê´€ë¦¬ìë‹˜</span>
            <button class="refresh-btn" onclick="refreshStats()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <a href="/admin" class="back-btn">ëŒ€ì‹œë³´ë“œ</a>
            <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</nav>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <div class="last-updated" id="lastUpdated">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span th:text="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd HH:mm:ss')}"></span>
        </div>
        <h1>âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • ë° í†µê³„</h1>
        <p>ì‹œìŠ¤í…œ ì „ì²´ í˜„í™©ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div th:if="${error}" class="error-message" th:text="${error}"></div>

    <!-- ì£¼ìš” í†µê³„ -->
    <div class="stats-grid">
        <!-- ì‚¬ìš©ì í†µê³„ -->
        <div class="stat-card user">
            <div class="stat-icon">ğŸ‘¥</div>
            <div class="stat-label">ì „ì²´ ì‚¬ìš©ì</div>
            <div class="stat-value" th:text="${systemStats.totalUsers}">0</div>
            <div class="stat-detail">
                í™œì„±: <span th:text="${systemStats.activeUsers}">0</span> |
                ë¹„í™œì„±: <span th:text="${systemStats.inactiveUsers}">0</span>
            </div>
        </div>

        <!-- ìƒí’ˆ í†µê³„ -->
        <div class="stat-card item">
            <div class="stat-icon">ğŸ“¦</div>
            <div class="stat-label">ì „ì²´ ìƒí’ˆ</div>
            <div class="stat-value" th:text="${systemStats.totalItems}">0</div>
            <div class="stat-detail">
                ì •ìƒ: <span th:text="${systemStats.visibleItems}">0</span> |
                ë¸”ë¼ì¸ë“œ: <span th:text="${systemStats.blindedItems}">0</span>
            </div>
        </div>

        <!-- ì´ë²ˆ ë‹¬ ì‹ ê·œ -->
        <div class="stat-card activity">
            <div class="stat-icon">ğŸ“ˆ</div>
            <div class="stat-label">ì´ë²ˆ ë‹¬ ì‹ ê·œ ì‚¬ìš©ì</div>
            <div class="stat-value" th:text="${systemStats.newUsersThisMonth}">0</div>
            <div class="stat-detail">
                ì˜¤ëŠ˜ ë“±ë¡ ìƒí’ˆ: <span th:text="${systemStats.itemsAddedToday}">0</span>
            </div>
        </div>

        <!-- ê´€ë¦¬ ë¡œê·¸ -->
        <div class="stat-card database">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-label">ê´€ë¦¬ ë¡œê·¸</div>
            <div class="stat-value" th:text="${systemStats.totalAdminLogs}">0</div>
            <div class="stat-detail">
                ì´ë²ˆ ë‹¬: <span th:text="${systemStats.logsThisMonth}">0</span>
            </div>
        </div>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
    <div class="section">
        <h2 class="section-title">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ìƒí’ˆ í†µê³„</h2>
        <div class="category-stats">
            <div class="category-item" th:each="entry : ${categoryStats}">
                <div class="category-name" th:text="${entry.key}">ì¹´í…Œê³ ë¦¬</div>
                <div class="category-count" th:text="${entry.value}">0</div>
            </div>
        </div>
    </div>

    <!-- ì£¼ê°„ í™œë™ í†µê³„ -->
    <div class="section">
        <h2 class="section-title">ğŸ“… ì£¼ê°„ í™œë™ í†µê³„</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ì´ë²ˆ ì£¼ ì‹ ê·œ ì‚¬ìš©ì</div>
                <div class="stat-value" th:text="${weeklyStats.newUsersThisWeek}">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì´ë²ˆ ì£¼ ì‹ ê·œ ìƒí’ˆ</div>
                <div class="stat-value" th:text="${weeklyStats.newItemsThisWeek}">0</div>
            </div>
        </div>
    </div>

    <!-- ìµœê·¼ í™œë™ -->
    <div class="section">
        <h2 class="section-title">ğŸ”” ìµœê·¼ í™œë™</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <!-- ìµœê·¼ ê°€ì… ì‚¬ìš©ì -->
            <div>
                <h3 style="margin-bottom: 1rem; color: #2c3e50;">ìµœê·¼ ê°€ì… ì‚¬ìš©ì</h3>
                <ul class="recent-activity-list">
                    <li class="activity-item" th:each="user : ${recentActivities.recentUsers}">
                        <div class="activity-info">
                            <div class="activity-name" th:text="${user.name}">ì‚¬ìš©ìëª…</div>
                            <div class="activity-detail" th:text="${user.email}">ì´ë©”ì¼</div>
                        </div>
                        <div class="activity-time" th:text="${#temporals.format(user.createdAt, 'MM-dd HH:mm')}">
                            ë‚ ì§œ
                        </div>
                    </li>
                </ul>
            </div>

            <!-- ìµœê·¼ ë“±ë¡ ìƒí’ˆ -->
            <div>
                <h3 style="margin-bottom: 1rem; color: #2c3e50;">ìµœê·¼ ë“±ë¡ ìƒí’ˆ</h3>
                <ul class="recent-activity-list">
                    <li class="activity-item" th:each="item : ${recentActivities.recentItems}">
                        <div class="activity-info">
                            <div class="activity-name" th:text="${item.title}">ìƒí’ˆëª…</div>
                            <div class="activity-detail" th:text="${item.seller.name}">íŒë§¤ì</div>
                        </div>
                        <div class="activity-time" th:text="${#temporals.format(item.createdAt, 'MM-dd HH:mm')}">
                            ë‚ ì§œ
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ -->
    <div class="section">
        <h2 class="section-title">ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´</h2>
        <div class="db-info-grid">
            <div class="db-info-item">
                <div class="db-info-label">ì „ì²´ ë ˆì½”ë“œ</div>
                <div class="db-info-value" th:text="${dbInfo.totalRecords}">0</div>
            </div>
            <div class="db-info-item">
                <div class="db-info-label">ì‚¬ìš©ì ë ˆì½”ë“œ</div>
                <div class="db-info-value" th:text="${dbInfo.userRecords}">0</div>
            </div>
            <div class="db-info-item">
                <div class="db-info-label">ìƒí’ˆ ë ˆì½”ë“œ</div>
                <div class="db-info-value" th:text="${dbInfo.itemRecords}">0</div>
            </div>
            <div class="db-info-item">
                <div class="db-info-label">ë¡œê·¸ ë ˆì½”ë“œ</div>
                <div class="db-info-value" th:text="${dbInfo.logRecords}">0</div>
            </div>
        </div>
    </div>
    <!-- ë©”ë‰´ ê´€ë¦¬ ì„¹ì…˜ -->
    <div class="section">
        <h2 class="section-title">ğŸ”— ê´€ë¦¬ì ë©”ë‰´ ê´€ë¦¬</h2>
        <p style="color: #7f8c8d; margin-bottom: 1.5rem;">
            ê´€ë¦¬ì í˜ì´ì§€ì— í‘œì‹œë  ì»¤ìŠ¤í…€ ë©”ë‰´ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>

        <!-- ë©”ë‰´ ì¶”ê°€ ë²„íŠ¼ -->
        <button class="add-menu-btn" onclick="showAddMenuModal()">â• ìƒˆ ë©”ë‰´ ì¶”ê°€</button>

        <!-- ë©”ë‰´ ëª©ë¡ í…Œì´ë¸” -->
        <table class="menu-table">
            <thead>
            <tr>
                <th>ìˆœì„œ</th>
                <th>ì•„ì´ì½˜</th>
                <th>ë©”ë‰´ëª…</th>
                <th>URL</th>
                <th>ì„¤ëª…</th>
                <th>ìƒíƒœ</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody id="menuTableBody">
            <tr th:each="menu : ${adminMenus}">
                <td th:text="${menu.displayOrder}">1</td>
                <td th:text="${menu.menuIcon}">ğŸ“‹</td>
                <td th:text="${menu.menuName}">ë©”ë‰´ëª…</td>
                <td th:text="${menu.menuUrl}">/admin/custom</td>
                <td th:text="${menu.description}">ì„¤ëª…</td>
                <td>
                    <span th:class="${menu.enabled} ? 'status-active' : 'status-inactive'"
                          th:text="${menu.enabled} ? 'í™œì„±' : 'ë¹„í™œì„±'">í™œì„±</span>
                </td>
                <td>
                    <button class="action-btn btn-edit"
                            th:onclick="'editMenu(' + ${menu.id} + ')'">ìˆ˜ì •</button>
                    <button class="action-btn btn-toggle"
                            th:onclick="'toggleMenuStatus(' + ${menu.id} + ')'">í† ê¸€</button>
                    <button class="action-btn btn-delete"
                            th:onclick="'deleteMenu(' + ${menu.id} + ')'">ì‚­ì œ</button>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- ë©”ë‰´ê°€ ì—†ì„ ë•Œ -->
        <div th:if="${adminMenus == null or adminMenus.isEmpty()}" class="no-data">
            <p>ë“±ë¡ëœ ì»¤ìŠ¤í…€ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ë©”ë‰´ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
        </div>
    </div>

   <!-- ë©”ë‰´ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMenuModal()">&times;</span>
            <h2 id="modalTitle">ìƒˆ ë©”ë‰´ ì¶”ê°€</h2>
            <form id="menuForm">
                <input type="hidden" id="menuId">

                <div class="form-group">
                    <label>ê²Œì‹œíŒ íƒ€ì… *</label>
                    <select id="boardType" class="form-input" required onchange="updateMenuFields()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="notice">ê³µì§€ì‚¬í•­</option>
                        <option value="free">ììœ ê²Œì‹œíŒ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ë©”ë‰´ëª…</label>
                    <input type="text" id="menuName" class="form-input" readonly
                           style="background-color: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label>URL</label>
                    <input type="text" id="menuUrl" class="form-input" readonly
                           style="background-color: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label>ì•„ì´ì½˜</label>
                    <input type="text" id="menuIcon" class="form-input" readonly
                           style="background-color: #f8f9fa;">
                </div>

                <div class="form-group">
                    <label>í‘œì‹œ ìˆœì„œ</label>
                    <input type="number" id="displayOrder" class="form-input"
                           value="0" min="0">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enabled" checked> í™œì„±í™”
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeMenuModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn-save">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // ë©”ë‰´ ê´€ë¦¬ í•¨ìˆ˜ë“¤
function showAddMenuModal() {
    document.getElementById('modalTitle').textContent = 'ìƒˆ ê²Œì‹œíŒ ì¶”ê°€';
    document.getElementById('menuForm').reset();
    document.getElementById('menuId').value = '';
    document.getElementById('enabled').checked = true;
    document.getElementById('boardType').value = '';
    document.getElementById('menuName').value = '';
    document.getElementById('menuUrl').value = '';
    document.getElementById('menuIcon').value = '';
    document.getElementById('menuModal').style.display = 'flex';
}

// ê²Œì‹œíŒ íƒ€ì…ì— ë”°ë¼ í•„ë“œ ìë™ ì—…ë°ì´íŠ¸
function updateMenuFields() {
    const boardType = document.getElementById('boardType').value;

    const typeConfig = {
        'notice': {
            name: 'ê³µì§€ì‚¬í•­',
            url: '/board/notice',
            icon: 'ğŸ“¢'
        },
        'free': {
            name: 'ììœ ê²Œì‹œíŒ',
            url: '/board/free',
            icon: 'ğŸ’¬'
        }
    };

    if (typeConfig[boardType]) {
        document.getElementById('menuName').value = typeConfig[boardType].name;
        document.getElementById('menuUrl').value = typeConfig[boardType].url;
        document.getElementById('menuIcon').value = typeConfig[boardType].icon;
    } else {
        document.getElementById('menuName').value = '';
        document.getElementById('menuUrl').value = '';
        document.getElementById('menuIcon').value = '';
    }
}

function editMenu(menuId) {
    // ë©”ë‰´ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    fetch('/admin/menu/' + menuId)
        .then(response => response.json())
        .then(menu => {
            document.getElementById('modalTitle').textContent = 'ê²Œì‹œíŒ ìˆ˜ì •';
            document.getElementById('menuId').value = menu.id;
            document.getElementById('boardType').value = menu.boardType;
            document.getElementById('menuName').value = menu.menuName;
            document.getElementById('menuUrl').value = menu.menuUrl;
            document.getElementById('menuIcon').value = menu.menuIcon;
            document.getElementById('displayOrder').value = menu.displayOrder;
            document.getElementById('enabled').checked = menu.enabled;

            // boardTypeì€ ìˆ˜ì • ë¶ˆê°€
            document.getElementById('boardType').disabled = true;

            document.getElementById('menuModal').style.display = 'flex';
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ë©”ë‰´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
}

// í¼ ì œì¶œ ì‹œ ì¶”ê°€/ìˆ˜ì • êµ¬ë¶„
document.getElementById('menuForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const menuId = document.getElementById('menuId').value;
    const boardType = document.getElementById('boardType').value;

    if (!boardType) {
        alert('ê²Œì‹œíŒ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    const menuData = {
        menuName: document.getElementById('menuName').value,
        menuUrl: document.getElementById('menuUrl').value,
        menuIcon: document.getElementById('menuIcon').value,
        displayOrder: parseInt(document.getElementById('displayOrder').value) || 0,
        description: boardType === 'notice' ? 'ê³µì§€ì‚¬í•­ ê²Œì‹œíŒ' : 'ììœ ê²Œì‹œíŒ',
        enabled: document.getElementById('enabled').checked,
        boardType: boardType
    };

    const url = menuId ? `/admin/menu/${menuId}/update` : '/admin/menu/add';
    const method = 'POST';

    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(menuData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(menuId ? 'ê²Œì‹œíŒì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê²Œì‹œíŒì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

function closeMenuModal() {
    document.getElementById('menuModal').style.display = 'none';
    document.getElementById('boardType').disabled = false; // ë‹¤ì‹œ í™œì„±í™”
}

function toggleMenuStatus(menuId) {
    if (!confirm('ê²Œì‹œíŒ ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    fetch('/admin/menu/' + menuId + '/toggle', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function deleteMenu(menuId) {
    if (!confirm('ì •ë§ ì´ ê²Œì‹œíŒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê²Œì‹œíŒì˜ ëª¨ë“  ê²Œì‹œê¸€ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;

    fetch('/admin/menu/' + menuId + '/delete', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ê²Œì‹œíŒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        } else {
            alert('ì˜¤ë¥˜: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

window.onclick = function(event) {
    const modal = document.getElementById('menuModal');
    if (event.target == modal) {
        closeMenuModal();
    }
}
</script>
</body>
</html>